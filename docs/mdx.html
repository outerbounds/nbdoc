---

title: Preprocessors For MDX


keywords: fastai
sidebar: home_sidebar

summary: "Custom preprocessors that help convert notebook content into MDX"
description: "Custom preprocessors that help convert notebook content into MDX"
nb_path: "nbs/mdx.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/mdx.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Cell-Tag-Cheatsheet">Cell Tag Cheatsheet<a class="anchor-link" href="#Cell-Tag-Cheatsheet"> </a></h2><p>These preprocessors allow you to make special comments to enable/disable them.  Here is a list of all special comments:</p>
<p>All comments start with <code>#meta</code> or <code>#cell_meta</code>, which are both aliases for the same thing.  For brevity, we will use <code>#meta</code> in this cheatsheet.</p>
<h3 id="Black-code-formatting">Black code formatting<a class="anchor-link" href="#Black-code-formatting"> </a></h3><p><code>#meta:tag=black</code> will apply black code formatting.</p>
<h3 id="Show/Hide-Cells">Show/Hide Cells<a class="anchor-link" href="#Show/Hide-Cells"> </a></h3><ol>
<li>Remvoe entire cells:  <code>#meta:tag=remove_cell</code> or <code>#meta:tag=hide</code></li>
<li>Remove output: <code>#meta:tag=remove_output</code> or <code>#meta:tag=remove_output</code> or <code>#meta:tag=hide_outputs</code> or <code>#meta:tag=hide_output</code></li>
<li>Remove input: same as above, except <code>input</code> instead of <code>output</code>.</li>
</ol>
<h3 id="Hiding-specific-lines-of-outptut">Hiding specific lines of outptut<a class="anchor-link" href="#Hiding-specific-lines-of-outptut"> </a></h3><ol>
<li>Remove lines of output containing keywords: <code>#meta:filter_words=FutureWarning,MultiIndex</code></li>
<li>Show maximum number of lines of output: <code>#meta:limit=6</code>, will show only the first 6 lines</li>
</ol>
<h3 id="Hiding-specific-lines-of-input-(code):">Hiding specific lines of input (code):<a class="anchor-link" href="#Hiding-specific-lines-of-input-(code):"> </a></h3><p>Use the comment <code>#meta_hide_line</code> to hide a specific line of code:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">show</span><span class="p">():</span>
    <span class="n">a</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">b</span> <span class="o">=</span> <span class="mi">3</span> <span class="c1">#meta_hide_line</span>
</pre></div>
<h3 id="Selecting-Metaflow-Steps">Selecting Metaflow Steps<a class="anchor-link" href="#Selecting-Metaflow-Steps"> </a></h3><p>You can selectively show meataflow steps in the output logs:</p>
<ol>
<li>Show one step: <code>#meta:show_steps=&lt;step_name&gt;</code></li>
<li>Show multiple steps: <code>#meta:show_steps=&lt;step1_name&gt;,&lt;step2_name&gt;</code></li>
</ol>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="InjectMeta" class="doc_header"><code>class</code> <code>InjectMeta</code><a href="https://github.com/outerbounds/nbdoc/tree/master/nbdoc/mdx.py#L23" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>InjectMeta</code>(<strong>*<code>args</code></strong>, <strong>**<code>kwargs</code></strong>) :: <code>Preprocessor</code></p>
</blockquote>
<p>Allows you to inject metadata into a cell for further preprocessing with a comment.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>To inject metadata make a comment in a cell with the following pattern: <code>#cell_meta:{key=value}</code>. Note that <code>#meta</code> is an alias for <code>#cell_meta</code></p>
<p>For example, consider the following code:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">_test_file</span> <span class="o">=</span> <span class="s1">&#39;test_files/hello_world.ipynb&#39;</span>
<span class="n">first_cell</span> <span class="o">=</span> <span class="n">read_nb</span><span class="p">(</span><span class="n">_test_file</span><span class="p">)[</span><span class="s1">&#39;cells&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">first_cell</span><span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>#meta:show_steps=start,train
print(&#39;hello world&#39;)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>At the moment, this cell has no metadata:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">first_cell</span><span class="p">[</span><span class="s1">&#39;metadata&#39;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>{}
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>However, after we process this notebook with <a href="/nbdoc/mdx.html#InjectMeta"><code>InjectMeta</code></a>, the appropriate metadata will be injected:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">c</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
<span class="n">c</span><span class="o">.</span><span class="n">NotebookExporter</span><span class="o">.</span><span class="n">preprocessors</span> <span class="o">=</span> <span class="p">[</span><span class="n">InjectMeta</span><span class="p">]</span>
<span class="n">exp</span> <span class="o">=</span> <span class="n">NotebookExporter</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">c</span><span class="p">)</span>
<span class="n">cells</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">from_filename</span><span class="p">(</span><span class="n">_test_file</span><span class="p">)</span>
<span class="n">first_cell</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">cells</span><span class="p">)[</span><span class="s1">&#39;cells&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

<span class="k">assert</span> <span class="n">first_cell</span><span class="p">[</span><span class="s1">&#39;metadata&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="p">{</span><span class="s1">&#39;nbdoc&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;show_steps&#39;</span><span class="p">:</span> <span class="s1">&#39;start,train&#39;</span><span class="p">}}</span>
<span class="n">first_cell</span><span class="p">[</span><span class="s1">&#39;metadata&#39;</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;nbdoc&#39;: {&#39;show_steps&#39;: &#39;start,train&#39;}}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="StripAnsi" class="doc_header"><code>class</code> <code>StripAnsi</code><a href="https://github.com/outerbounds/nbdoc/tree/master/nbdoc/mdx.py#L44" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>StripAnsi</code>(<strong>*<code>args</code></strong>, <strong>**<code>kwargs</code></strong>) :: <code>Preprocessor</code></p>
</blockquote>
<p>Strip Ansi Characters.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Gets rid of colors that are streamed from standard out, which can interfere with static site generators:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">c</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">run_preprocessor</span><span class="p">([</span><span class="n">StripAnsi</span><span class="p">],</span> <span class="s1">&#39;test_files/run_flow.ipynb&#39;</span><span class="p">)</span>
<span class="k">assert</span> <span class="ow">not</span> <span class="n">_re_ansi_escape</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="InsertWarning" class="doc_header"><code>class</code> <code>InsertWarning</code><a href="https://github.com/outerbounds/nbdoc/tree/master/nbdoc/mdx.py#L67" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>InsertWarning</code>(<strong>*<code>args</code></strong>, <strong>**<code>kwargs</code></strong>) :: <code>Preprocessor</code></p>
</blockquote>
<p>Insert Autogenerated Warning Into Notebook after the first cell.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This preprocessor inserts a warning in the markdown destination that the file is autogenerated.  This warning is inserted in the second cell so we do not interfere with front matter.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">c</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">run_preprocessor</span><span class="p">([</span><span class="n">InsertWarning</span><span class="p">],</span> <span class="s1">&#39;test_files/hello_world.ipynb&#39;</span><span class="p">,</span> <span class="n">display_results</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">assert</span> <span class="s2">&quot;&lt;!-- WARNING: THIS FILE WAS AUTOGENERATED!&quot;</span> <span class="ow">in</span> <span class="n">c</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>```python
#meta:show_steps=start,train
print(&#39;hello world&#39;)
```

&lt;CodeOutputBlock lang=&#34;python&#34;&gt;

```
    hello world
```

&lt;/CodeOutputBlock&gt;

&lt;!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! Instead, edit the notebook w/the location &amp; name as this file. --&gt;


```python

```

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="RmEmptyCode" class="doc_header"><code>class</code> <code>RmEmptyCode</code><a href="https://github.com/outerbounds/nbdoc/tree/master/nbdoc/mdx.py#L81" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>RmEmptyCode</code>(<strong>*<code>args</code></strong>, <strong>**<code>kwargs</code></strong>) :: <code>Preprocessor</code></p>
</blockquote>
<p>Remove empty code cells.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Notice how this notebook has an empty code cell at the end:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">show_plain_md</span><span class="p">(</span><span class="s1">&#39;test_files/hello_world.ipynb&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>```python
#meta:show_steps=start,train
print(&#39;hello world&#39;)
```

    hello world



```python

```

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>With <a href="/nbdoc/mdx.html#RmEmptyCode"><code>RmEmptyCode</code></a> these empty code cells are stripped from the markdown:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">c</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">run_preprocessor</span><span class="p">([</span><span class="n">RmEmptyCode</span><span class="p">],</span> <span class="s1">&#39;test_files/hello_world.ipynb&#39;</span><span class="p">,</span> <span class="n">display_results</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;```python&#39;</span><span class="p">,</span><span class="n">c</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>```python
#meta:show_steps=start,train
print(&#39;hello world&#39;)
```

&lt;CodeOutputBlock lang=&#34;python&#34;&gt;

```
    hello world
```

&lt;/CodeOutputBlock&gt;

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="MetaflowTruncate" class="doc_header"><code>class</code> <code>MetaflowTruncate</code><a href="https://github.com/outerbounds/nbdoc/tree/master/nbdoc/mdx.py#L89" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>MetaflowTruncate</code>(<strong>*<code>args</code></strong>, <strong>**<code>kwargs</code></strong>) :: <code>Preprocessor</code></p>
</blockquote>
<p>Remove the preamble and timestamp from Metaflow output.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>When you run a metaflow Flow, you are presented with a fair amount of boilerpalte before the job starts running that is not necesary to show in the documentation:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">show_plain_md</span><span class="p">(</span><span class="s1">&#39;test_files/run_flow.ipynb&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>```python
#meta:show_steps=start
!python myflow.py run
```

    <span class="ansi-magenta-intense-fg ansi-bold">Metaflow 2.5.3</span><span class="ansi-magenta-fg"> executing </span><span class="ansi-red-intense-fg ansi-bold">MyFlow</span><span class="ansi-magenta-fg"> for </span><span class="ansi-red-intense-fg ansi-bold">user:hamel</span>
    <span class="ansi-magenta-fg">Validating your flow...</span>
    <span class="ansi-green-intense-fg ansi-bold">    The graph looks good!</span>
    <span class="ansi-magenta-fg">Running pylint...</span>
    <span class="ansi-green-intense-fg ansi-bold">    Pylint is happy!</span>
    <span class="ansi-magenta-fg">2022-03-14 17:28:44.983 </span><span class="ansi-bold">Workflow starting (run-id 1647304124981100):</span>
    <span class="ansi-magenta-fg">2022-03-14 17:28:44.990 </span><span class="ansi-green-fg">[1647304124981100/start/1 (pid 41951)] </span><span class="ansi-bold">Task is starting.</span>
    <span class="ansi-magenta-fg">2022-03-14 17:28:45.630 </span><span class="ansi-green-fg">[1647304124981100/start/1 (pid 41951)] </span>this is the start
    <span class="ansi-magenta-fg">2022-03-14 17:28:45.704 </span><span class="ansi-green-fg">[1647304124981100/start/1 (pid 41951)] </span><span class="ansi-bold">Task finished successfully.</span>
    <span class="ansi-magenta-fg">2022-03-14 17:28:45.710 </span><span class="ansi-green-fg">[1647304124981100/end/2 (pid 41954)] </span><span class="ansi-bold">Task is starting.</span>
    <span class="ansi-magenta-fg">2022-03-14 17:28:46.348 </span><span class="ansi-green-fg">[1647304124981100/end/2 (pid 41954)] </span>this is the end
    <span class="ansi-magenta-fg">2022-03-14 17:28:46.422 </span><span class="ansi-green-fg">[1647304124981100/end/2 (pid 41954)] </span><span class="ansi-bold">Task finished successfully.</span>
    <span class="ansi-magenta-fg">2022-03-14 17:28:46.423 </span><span class="ansi-bold">Done!</span>
    

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We don't need to see the beginning part that validates the graph, and we don't need the time-stamps either.  We can remove these with the <a href="/nbdoc/mdx.html#MetaflowTruncate"><code>MetaflowTruncate</code></a> preprocessor:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">c</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">run_preprocessor</span><span class="p">([</span><span class="n">MetaflowTruncate</span><span class="p">],</span> <span class="s1">&#39;test_files/run_flow.ipynb&#39;</span><span class="p">,</span> <span class="n">display_results</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">assert</span> <span class="s1">&#39;Validating your flow...&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">c</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>```python
#meta:show_steps=start
!python myflow.py run
```

&lt;CodeOutputBlock lang=&#34;python&#34;&gt;

```
    <span class="ansi-magenta-fg"> </span><span class="ansi-bold">Workflow starting (run-id 1647304124981100):</span>
    <span class="ansi-magenta-fg"> </span><span class="ansi-green-fg">[1647304124981100/start/1 (pid 41951)] </span><span class="ansi-bold">Task is starting.</span>
    <span class="ansi-magenta-fg"> </span><span class="ansi-green-fg">[1647304124981100/start/1 (pid 41951)] </span>this is the start
    <span class="ansi-magenta-fg"> </span><span class="ansi-green-fg">[1647304124981100/start/1 (pid 41951)] </span><span class="ansi-bold">Task finished successfully.</span>
    <span class="ansi-magenta-fg"> </span><span class="ansi-green-fg">[1647304124981100/end/2 (pid 41954)] </span><span class="ansi-bold">Task is starting.</span>
    <span class="ansi-magenta-fg"> </span><span class="ansi-green-fg">[1647304124981100/end/2 (pid 41954)] </span>this is the end
    <span class="ansi-magenta-fg"> </span><span class="ansi-green-fg">[1647304124981100/end/2 (pid 41954)] </span><span class="ansi-bold">Task finished successfully.</span>
    <span class="ansi-magenta-fg"> </span><span class="ansi-bold">Done!</span>
    
```

&lt;/CodeOutputBlock&gt;

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="UpdateTags" class="doc_header"><code>class</code> <code>UpdateTags</code><a href="https://github.com/outerbounds/nbdoc/tree/master/nbdoc/mdx.py#L102" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>UpdateTags</code>(<strong>*<code>args</code></strong>, <strong>**<code>kwargs</code></strong>) :: <code>Preprocessor</code></p>
</blockquote>
<p>Create cell tags based upon comment <code>#cell_meta:tags=&lt;tag&gt;</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered celltag_foo">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Consider this python notebook prior to processing.  The comments can be used configure the visibility of cells.</p>
<ul>
<li><code>#cell_meta:tags=remove_output</code> will just remove the output</li>
<li><code>#cell_meta:tags=remove_input</code> will just remove the input</li>
<li><code>#cell_meta:tags=remove_cell</code> will remove both the input and output</li>
</ul>
<p>Note that you can use <code>#cell_meta:tag</code> or <code>#cell_meta:tags</code> as they are both aliases for the same thing.  Here is a notebook before preprocessing:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">show_plain_md</span><span class="p">(</span><span class="s1">&#39;test_files/visibility.ipynb&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre># Configuring Cell Visibility

#### Cell with the comment `#cell_meta:tag=remove_output`


```
#cell_meta:tag=remove_output
print(&#39;the output is removed, so you can only see the print statement.&#39;)
```

    the output is removed, so you can only see the print statement.


#### Cell with the comment `#cell_meta:tag=remove_input`


```
#cell_meta:tag=remove_input
print(&#39;hello, you cannot see the code that created me.&#39;)
```

    hello, you cannot see the code that created me.


#### Cell with the comment `#cell_meta:tag=remove_cell`


```
#cell_meta:tag=remove_cell
print(&#39;you will not be able to see this cell at all&#39;)
```

    you will not be able to see this cell at all



```
#cell_meta:tags=remove_input,remove_output
print(&#39;you will not be able to see this cell at all either&#39;)
```

    you will not be able to see this cell at all either


</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="/nbdoc/mdx.html#UpdateTags"><code>UpdateTags</code></a> is meant to be used with <a href="/nbdoc/mdx.html#InjectMeta"><code>InjectMeta</code></a> and <code>TagRemovePreprocessor</code> to configure the visibility of cells in rendered docs.  Here you can see what the notebook looks like after pre-processing:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">_test_file</span> <span class="o">=</span> <span class="s1">&#39;test_files/visibility.ipynb&#39;</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
<span class="n">c</span><span class="o">.</span><span class="n">TagRemovePreprocessor</span><span class="o">.</span><span class="n">remove_cell_tags</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;remove_cell&quot;</span><span class="p">,)</span>
<span class="n">c</span><span class="o">.</span><span class="n">TagRemovePreprocessor</span><span class="o">.</span><span class="n">remove_all_outputs_tags</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;remove_output&#39;</span><span class="p">,)</span>
<span class="n">c</span><span class="o">.</span><span class="n">TagRemovePreprocessor</span><span class="o">.</span><span class="n">remove_input_tags</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;remove_input&#39;</span><span class="p">,)</span>
<span class="n">c</span><span class="o">.</span><span class="n">MarkdownExporter</span><span class="o">.</span><span class="n">preprocessors</span> <span class="o">=</span> <span class="p">[</span><span class="n">InjectMeta</span><span class="p">,</span> <span class="n">UpdateTags</span><span class="p">,</span> <span class="n">TagRemovePreprocessor</span><span class="p">]</span>
<span class="n">exp</span> <span class="o">=</span> <span class="n">MarkdownExporter</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">c</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">from_filename</span><span class="p">(</span><span class="n">_test_file</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># show the results</span>
<span class="k">assert</span> <span class="s1">&#39;you will not be able to see this cell at all either&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">result</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre># Configuring Cell Visibility

#### Cell with the comment `#cell_meta:tag=remove_output`


```
#cell_meta:tag=remove_output
print(&#39;the output is removed, so you can only see the print statement.&#39;)
```

#### Cell with the comment `#cell_meta:tag=remove_input`

    hello, you cannot see the code that created me.


#### Cell with the comment `#cell_meta:tag=remove_cell`

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="MetaflowSelectSteps" class="doc_header"><code>class</code> <code>MetaflowSelectSteps</code><a href="https://github.com/outerbounds/nbdoc/tree/master/nbdoc/mdx.py#L114" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>MetaflowSelectSteps</code>(<strong>*<code>args</code></strong>, <strong>**<code>kwargs</code></strong>) :: <code>Preprocessor</code></p>
</blockquote>
<p>Hide Metaflow steps in output based on cell metadata.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="/nbdoc/mdx.html#MetaflowSelectSteps"><code>MetaflowSelectSteps</code></a> is meant to be used with <a href="/nbdoc/mdx.html#InjectMeta"><code>InjectMeta</code></a> to only show specific steps in the output logs from Metaflow.</p>
<p>For example, if you want to only show the <code>start</code> and <code>train</code> steps in your flow, you would annotate your cell with the following pattern: <code>#cell_meta:show_steps=&lt;step_name&gt;</code></p>
<p>Note that <code>show_step</code> and <code>show_steps</code> are aliases for convenience, so you don't need to worry about the <code>s</code> at the end.</p>
<p>In the below example, <code>#cell_meta:show_steps=start,train</code> shows the <code>start</code> and <code>train</code> steps, whereas <code>#cell_meta:show_steps=train</code> only shows the <code>train</code> step:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">c</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">run_preprocessor</span><span class="p">([</span><span class="n">InjectMeta</span><span class="p">,</span> <span class="n">MetaflowSelectSteps</span><span class="p">],</span> 
                        <span class="s1">&#39;test_files/run_flow_showstep.ipynb&#39;</span><span class="p">,</span> 
                        <span class="n">display_results</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">assert</span> <span class="s1">&#39;end&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">c</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>```
#cell_meta:show_steps=start,train
!python myflow.py run
```

&lt;CodeOutputBlock lang=&#34;&#34;&gt;

```
    ...
    <span class="ansi-magenta-fg">2022-02-15 14:01:14.810 </span><span class="ansi-green-fg">[1644962474801237/start/1 (pid 46758)] </span><span class="ansi-bold">Task is starting.</span>
    <span class="ansi-magenta-fg">2022-02-15 14:01:15.433 </span><span class="ansi-green-fg">[1644962474801237/start/1 (pid 46758)] </span>this is the start
    <span class="ansi-magenta-fg">2022-02-15 14:01:15.500 </span><span class="ansi-green-fg">[1644962474801237/start/1 (pid 46758)] </span><span class="ansi-bold">Task finished successfully.</span>
    ...
    <span class="ansi-magenta-fg">2022-02-15 14:01:15.507 </span><span class="ansi-green-fg">[1644962474801237/train/2 (pid 46763)] </span><span class="ansi-bold">Task is starting.</span>
    <span class="ansi-magenta-fg">2022-02-15 14:01:16.123 </span><span class="ansi-green-fg">[1644962474801237/train/2 (pid 46763)] </span>the train step
    <span class="ansi-magenta-fg">2022-02-15 14:01:16.188 </span><span class="ansi-green-fg">[1644962474801237/train/2 (pid 46763)] </span><span class="ansi-bold">Task finished successfully.</span>
    ...
```

&lt;/CodeOutputBlock&gt;


```
#cell_meta:show_steps=train
!python myflow.py run
```

&lt;CodeOutputBlock lang=&#34;&#34;&gt;

```
    ...
    <span class="ansi-magenta-fg">2022-02-15 14:01:18.924 </span><span class="ansi-green-fg">[1644962478210532/train/2 (pid 46783)] </span><span class="ansi-bold">Task is starting.</span>
    <span class="ansi-magenta-fg">2022-02-15 14:01:19.566 </span><span class="ansi-green-fg">[1644962478210532/train/2 (pid 46783)] </span>the train step
    <span class="ansi-magenta-fg">2022-02-15 14:01:19.632 </span><span class="ansi-green-fg">[1644962478210532/train/2 (pid 46783)] </span><span class="ansi-bold">Task finished successfully.</span>
    ...
```

&lt;/CodeOutputBlock&gt;

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="FilterOutput" class="doc_header"><code>class</code> <code>FilterOutput</code><a href="https://github.com/outerbounds/nbdoc/tree/master/nbdoc/mdx.py#L135" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>FilterOutput</code>(<strong>*<code>args</code></strong>, <strong>**<code>kwargs</code></strong>) :: <code>Preprocessor</code></p>
</blockquote>
<p>Hide Output Based on Keywords.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>If we want to exclude output with certain keywords, we can use the <code>#meta:filter_words</code> comment.  For example, if we wanted to ignore all output that contains the text <code>FutureWarning</code> or <code>MultiIndex</code> we can use the comment:</p>
<p><code>#meta:filter_words=FutureWarning,MultiIndex</code></p>
<p>Consider this output below:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">show_plain_md</span><span class="p">(</span><span class="s1">&#39;test_files/strip_out.ipynb&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>```python
#meta:filter_words=FutureWarning,MultiIndex
#meta:show_steps=end
!python serialize_xgb_dmatrix.py run
```

    /Users/hamel/opt/anaconda3/lib/python3.9/site-packages/xgboost/compat.py:36: FutureWarning: pandas.Int64Index is deprecated and will be removed from pandas in a future version. Use pandas.Index with the appropriate dtype instead.
      from pandas import MultiIndex, Int64Index
    <span class="ansi-magenta-intense-fg ansi-bold">Metaflow 2.5.3</span><span class="ansi-magenta-fg"> executing </span><span class="ansi-red-intense-fg ansi-bold">SerializeXGBDataFlow</span><span class="ansi-magenta-fg"> for </span><span class="ansi-red-intense-fg ansi-bold">user:hamel</span>
    <span class="ansi-magenta-fg">Validating your flow...</span>
    <span class="ansi-green-intense-fg ansi-bold">    The graph looks good!</span>
    <span class="ansi-magenta-fg">Running pylint...</span>
    <span class="ansi-green-intense-fg ansi-bold">    Pylint is happy!</span>
    <span class="ansi-magenta-fg">2022-03-30 07:04:02.315 </span><span class="ansi-bold">Workflow starting (run-id 1648649042312116):</span>
    <span class="ansi-magenta-fg">2022-03-30 07:04:02.322 </span><span class="ansi-green-fg">[1648649042312116/start/1 (pid 2459)] </span><span class="ansi-bold">Task is starting.</span>
    <span class="ansi-magenta-fg">2022-03-30 07:04:03.122 </span><span class="ansi-green-fg">[1648649042312116/start/1 (pid 2459)] </span>/Users/hamel/opt/anaconda3/lib/python3.9/site-packages/xgboost/compat.py:36: FutureWarning: pandas.Int64Index is deprecated and will be removed from pandas in a future version. Use pandas.Index with the appropriate dtype instead.
    <span class="ansi-magenta-fg">2022-03-30 07:04:03.508 </span><span class="ansi-green-fg">[1648649042312116/start/1 (pid 2459)] </span>from pandas import MultiIndex, Int64Index
    <span class="ansi-magenta-fg">2022-03-30 07:04:03.510 </span><span class="ansi-green-fg">[1648649042312116/start/1 (pid 2459)] </span><span class="ansi-bold">Task finished successfully.</span>
    <span class="ansi-magenta-fg">2022-03-30 07:04:03.517 </span><span class="ansi-green-fg">[1648649042312116/end/2 (pid 2462)] </span><span class="ansi-bold">Task is starting.</span>
    <span class="ansi-magenta-fg">2022-03-30 07:04:04.315 </span><span class="ansi-green-fg">[1648649042312116/end/2 (pid 2462)] </span>/Users/hamel/opt/anaconda3/lib/python3.9/site-packages/xgboost/compat.py:36: FutureWarning: pandas.Int64Index is deprecated and will be removed from pandas in a future version. Use pandas.Index with the appropriate dtype instead.
    <span class="ansi-magenta-fg">2022-03-30 07:04:04.563 </span><span class="ansi-green-fg">[1648649042312116/end/2 (pid 2462)] </span>there are 5 rows in the data.
    <span class="ansi-magenta-fg">2022-03-30 07:04:04.705 </span><span class="ansi-green-fg">[1648649042312116/end/2 (pid 2462)] </span>from pandas import MultiIndex, Int64Index
    <span class="ansi-magenta-fg">2022-03-30 07:04:04.707 </span><span class="ansi-green-fg">[1648649042312116/end/2 (pid 2462)] </span><span class="ansi-bold">Task finished successfully.</span>
    <span class="ansi-magenta-fg">2022-03-30 07:04:04.707 </span><span class="ansi-bold">Done!</span>
    

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Notice how the lines containing the terms <code>FutureWarning</code> or <code>MultiIndex</code> are stripped out:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">c</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">run_preprocessor</span><span class="p">([</span><span class="n">InjectMeta</span><span class="p">,</span> <span class="n">FilterOutput</span><span class="p">],</span> 
                        <span class="s1">&#39;test_files/strip_out.ipynb&#39;</span><span class="p">,</span> 
                        <span class="n">display_results</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">assert</span> <span class="s1">&#39;FutureWarning:&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">c</span> <span class="ow">and</span> <span class="s1">&#39;from pandas import MultiIndex, Int64Index&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">c</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>```python
#meta:filter_words=FutureWarning,MultiIndex
#meta:show_steps=end
!python serialize_xgb_dmatrix.py run
```

&lt;CodeOutputBlock lang=&#34;python&#34;&gt;

```
    <span class="ansi-magenta-intense-fg ansi-bold">Metaflow 2.5.3</span><span class="ansi-magenta-fg"> executing </span><span class="ansi-red-intense-fg ansi-bold">SerializeXGBDataFlow</span><span class="ansi-magenta-fg"> for </span><span class="ansi-red-intense-fg ansi-bold">user:hamel</span>
    <span class="ansi-magenta-fg">Validating your flow...</span>
    <span class="ansi-green-intense-fg ansi-bold">    The graph looks good!</span>
    <span class="ansi-magenta-fg">Running pylint...</span>
    <span class="ansi-green-intense-fg ansi-bold">    Pylint is happy!</span>
    <span class="ansi-magenta-fg">2022-03-30 07:04:02.315 </span><span class="ansi-bold">Workflow starting (run-id 1648649042312116):</span>
    <span class="ansi-magenta-fg">2022-03-30 07:04:02.322 </span><span class="ansi-green-fg">[1648649042312116/start/1 (pid 2459)] </span><span class="ansi-bold">Task is starting.</span>
    <span class="ansi-magenta-fg">2022-03-30 07:04:03.510 </span><span class="ansi-green-fg">[1648649042312116/start/1 (pid 2459)] </span><span class="ansi-bold">Task finished successfully.</span>
    <span class="ansi-magenta-fg">2022-03-30 07:04:03.517 </span><span class="ansi-green-fg">[1648649042312116/end/2 (pid 2462)] </span><span class="ansi-bold">Task is starting.</span>
    <span class="ansi-magenta-fg">2022-03-30 07:04:04.563 </span><span class="ansi-green-fg">[1648649042312116/end/2 (pid 2462)] </span>there are 5 rows in the data.
    <span class="ansi-magenta-fg">2022-03-30 07:04:04.707 </span><span class="ansi-green-fg">[1648649042312116/end/2 (pid 2462)] </span><span class="ansi-bold">Task finished successfully.</span>
    <span class="ansi-magenta-fg">2022-03-30 07:04:04.707 </span><span class="ansi-bold">Done!</span>
    
```

&lt;/CodeOutputBlock&gt;

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Limit" class="doc_header"><code>class</code> <code>Limit</code><a href="https://github.com/outerbounds/nbdoc/tree/master/nbdoc/mdx.py#L151" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>Limit</code>(<strong>*<code>args</code></strong>, <strong>**<code>kwargs</code></strong>) :: <code>Preprocessor</code></p>
</blockquote>
<p>Limit The Number of Lines Of Output Based on Keywords.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">/var/folders/jj/xl1rktcs6mn7ms6b8vvx8k4r0000gn/T/ipykernel_12430/4104533903.py</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> <span class="ansi-red-fg">#export</span>
<span class="ansi-green-fg">----&gt; 2</span><span class="ansi-red-fg"> </span><span class="ansi-green-fg">class</span> Limit<span class="ansi-blue-fg">(</span>Preprocessor<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">      3</span>     &#34;&#34;&#34;
<span class="ansi-green-intense-fg ansi-bold">      4</span>     Limit The Number of Lines Of Output Based on Keywords<span class="ansi-blue-fg">.</span>
<span class="ansi-green-intense-fg ansi-bold">      5</span>     &#34;&#34;&#34;

<span class="ansi-red-fg">NameError</span>: name &#39;Preprocessor&#39; is not defined</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">c</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">run_preprocessor</span><span class="p">([</span><span class="n">InjectMeta</span><span class="p">,</span> <span class="n">Limit</span><span class="p">],</span> 
                        <span class="s1">&#39;test_files/limit.ipynb&#39;</span><span class="p">,</span> 
                        <span class="n">display_results</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">_res</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;```</span>
<span class="s2">    hello</span>
<span class="s2">    hello</span>
<span class="s2">    hello</span>
<span class="s2">    hello</span>
<span class="s2">    hello</span>
<span class="s2">    ...</span>
<span class="s2">```&quot;&quot;&quot;</span>
<span class="k">assert</span> <span class="n">_res</span> <span class="ow">in</span> <span class="n">c</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>```python
#meta:limit=6
!python serialize_xgb_dmatrix.py run
```

&lt;CodeOutputBlock lang=&#34;python&#34;&gt;

```
    /Users/hamel/opt/anaconda3/lib/python3.9/site-packages/xgboost/compat.py:36: FutureWarning: pandas.Int64Index is deprecated and will be removed from pandas in a future version. Use pandas.Index with the appropriate dtype instead.
      from pandas import MultiIndex, Int64Index
    <span class="ansi-magenta-intense-fg ansi-bold">Metaflow 2.5.3</span><span class="ansi-magenta-fg"> executing </span><span class="ansi-red-intense-fg ansi-bold">SerializeXGBDataFlow</span><span class="ansi-magenta-fg"> for </span><span class="ansi-red-intense-fg ansi-bold">user:hamel</span>
    <span class="ansi-magenta-fg">Validating your flow...</span>
    <span class="ansi-green-intense-fg ansi-bold">    The graph looks good!</span>
    <span class="ansi-magenta-fg">Running pylint...</span>
    ...
```

&lt;/CodeOutputBlock&gt;


```python
#meta:limit=5
print(&#39;\n&#39;.join([&#39;hello&#39;]*10))
```

&lt;CodeOutputBlock lang=&#34;python&#34;&gt;

```
    hello
    hello
    hello
    hello
    hello
    ...
```

&lt;/CodeOutputBlock&gt;

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="HideInputLines" class="doc_header"><code>class</code> <code>HideInputLines</code><a href="https://github.com/outerbounds/nbdoc/tree/master/nbdoc/mdx.py#L165" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>HideInputLines</code>(<strong>*<code>args</code></strong>, <strong>**<code>kwargs</code></strong>) :: <code>Preprocessor</code></p>
</blockquote>
<p>Hide lines of code in code cells with the comment <code>#meta_hide_line</code> at the end of a line of code.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>You can use the special comment <code>#meta_hide_line</code> to hide a specific line of code in a code cell.  This is what the code looks like before:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">show_plain_md</span><span class="p">(</span><span class="s1">&#39;test_files/hide_lines.ipynb&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>```python
def show():
    a = 2
    b = 3 #meta_hide_line
```

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>and after:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">c</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">run_preprocessor</span><span class="p">([</span><span class="n">InjectMeta</span><span class="p">,</span> <span class="n">HideInputLines</span><span class="p">],</span> 
                        <span class="s1">&#39;test_files/hide_lines.ipynb&#39;</span><span class="p">,</span> 
                        <span class="n">display_results</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>```python
def show():
    a = 2
```

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="WriteTitle" class="doc_header"><code>class</code> <code>WriteTitle</code><a href="https://github.com/outerbounds/nbdoc/tree/master/nbdoc/mdx.py#L178" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>WriteTitle</code>(<strong>*<code>args</code></strong>, <strong>**<code>kwargs</code></strong>) :: <code>Preprocessor</code></p>
</blockquote>
<p>Modify the code-fence with the filename upon %%writefile cell magic.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="/nbdoc/mdx.html#WriteTitle"><code>WriteTitle</code></a> creates the proper code-fence with a title in the situation where the <code>%%writefile</code> magic is used.</p>
<p>For example, here are contents before pre-processing:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">show_plain_md</span><span class="p">(</span><span class="s1">&#39;test_files/writefile.ipynb&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>A test notebook


```python
%%writefile myflow.py
from metaflow import FlowSpec, step

class MyFlow(FlowSpec):
    
    @step
    def start(self):
        print(&#39;this is the start&#39;)
        self.next(self.train)
    
    @step
    def train(self):
        print(&#39;the train step&#39;)
        self.next(self.end)
    
    @step
    def end(self):
        print(&#39;this is the end&#39;)

if __name__ == &#39;__main__&#39;:
    MyFlow()
```

    Overwriting myflow.py



```python
%%writefile hello.txt

Hello World
```

    Overwriting hello.txt


</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>When we use <a href="/nbdoc/mdx.html#WriteTitle"><code>WriteTitle</code></a>, you will see the code-fence will change appropriately:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">c</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">run_preprocessor</span><span class="p">([</span><span class="n">WriteTitle</span><span class="p">],</span> <span class="s1">&#39;test_files/writefile.ipynb&#39;</span><span class="p">,</span> <span class="n">display_results</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">assert</span> <span class="s1">&#39;```py title=&quot;myflow.py&quot;&#39;</span> <span class="ow">in</span> <span class="n">c</span> <span class="ow">and</span> <span class="s1">&#39;```txt title=&quot;hello.txt&quot;&#39;</span> <span class="ow">in</span> <span class="n">c</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>A test notebook


```py title=&#34;myflow.py&#34;
%%writefile myflow.py
from metaflow import FlowSpec, step

class MyFlow(FlowSpec):
    
    @step
    def start(self):
        print(&#39;this is the start&#39;)
        self.next(self.train)
    
    @step
    def train(self):
        print(&#39;the train step&#39;)
        self.next(self.end)
    
    @step
    def end(self):
        print(&#39;this is the end&#39;)

if __name__ == &#39;__main__&#39;:
    MyFlow()
```


```txt title=&#34;hello.txt&#34;
%%writefile hello.txt

Hello World
```

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="CleanFlags" class="doc_header"><code>class</code> <code>CleanFlags</code><a href="https://github.com/outerbounds/nbdoc/tree/master/nbdoc/mdx.py#L197" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>CleanFlags</code>(<strong>*<code>args</code></strong>, <strong>**<code>kwargs</code></strong>) :: <code>Preprocessor</code></p>
</blockquote>
<p>A preprocessor to remove Flags</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">c</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">run_preprocessor</span><span class="p">([</span><span class="n">CleanFlags</span><span class="p">],</span> <span class="n">_gen_nb</span><span class="p">())</span>
<span class="k">assert</span> <span class="s1">&#39;#notest&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">c</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="CleanMagics" class="doc_header"><code>class</code> <code>CleanMagics</code><a href="https://github.com/outerbounds/nbdoc/tree/master/nbdoc/mdx.py#L208" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>CleanMagics</code>(<strong>*<code>args</code></strong>, <strong>**<code>kwargs</code></strong>) :: <code>Preprocessor</code></p>
</blockquote>
<p>A preprocessor to remove cell magic commands and #cell_meta: comments</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="/nbdoc/mdx.html#CleanMagics"><code>CleanMagics</code></a> strips magic cell commands <code>%%</code> so they do not appear in rendered markdown files:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">c</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">run_preprocessor</span><span class="p">([</span><span class="n">WriteTitle</span><span class="p">,</span> <span class="n">CleanMagics</span><span class="p">],</span> <span class="s1">&#39;test_files/writefile.ipynb&#39;</span><span class="p">,</span> <span class="n">display_results</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">assert</span> <span class="s1">&#39;</span><span class="si">%%</span><span class="s1">&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">c</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>A test notebook


```py title=&#34;myflow.py&#34;
from metaflow import FlowSpec, step

class MyFlow(FlowSpec):
    
    @step
    def start(self):
        print(&#39;this is the start&#39;)
        self.next(self.train)
    
    @step
    def train(self):
        print(&#39;the train step&#39;)
        self.next(self.end)
    
    @step
    def end(self):
        print(&#39;this is the end&#39;)

if __name__ == &#39;__main__&#39;:
    MyFlow()
```


```txt title=&#34;hello.txt&#34;
Hello World
```

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Here is how <a href="/nbdoc/mdx.html#CleanMagics"><code>CleanMagics</code></a> Works on the file with the Metaflow log outputs from earlier, we can see that the <code>#cell_meta</code> comments are gone:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">c</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">run_preprocessor</span><span class="p">([</span><span class="n">InjectMeta</span><span class="p">,</span> <span class="n">MetaflowSelectSteps</span><span class="p">,</span> <span class="n">CleanMagics</span><span class="p">],</span> 
                        <span class="s1">&#39;test_files/run_flow_showstep.ipynb&#39;</span><span class="p">,</span> <span class="n">display_results</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>```
!python myflow.py run
```

&lt;CodeOutputBlock lang=&#34;&#34;&gt;

```
    ...
    <span class="ansi-magenta-fg">2022-02-15 14:01:14.810 </span><span class="ansi-green-fg">[1644962474801237/start/1 (pid 46758)] </span><span class="ansi-bold">Task is starting.</span>
    <span class="ansi-magenta-fg">2022-02-15 14:01:15.433 </span><span class="ansi-green-fg">[1644962474801237/start/1 (pid 46758)] </span>this is the start
    <span class="ansi-magenta-fg">2022-02-15 14:01:15.500 </span><span class="ansi-green-fg">[1644962474801237/start/1 (pid 46758)] </span><span class="ansi-bold">Task finished successfully.</span>
    ...
    <span class="ansi-magenta-fg">2022-02-15 14:01:15.507 </span><span class="ansi-green-fg">[1644962474801237/train/2 (pid 46763)] </span><span class="ansi-bold">Task is starting.</span>
    <span class="ansi-magenta-fg">2022-02-15 14:01:16.123 </span><span class="ansi-green-fg">[1644962474801237/train/2 (pid 46763)] </span>the train step
    <span class="ansi-magenta-fg">2022-02-15 14:01:16.188 </span><span class="ansi-green-fg">[1644962474801237/train/2 (pid 46763)] </span><span class="ansi-bold">Task finished successfully.</span>
    ...
```

&lt;/CodeOutputBlock&gt;


```
!python myflow.py run
```

&lt;CodeOutputBlock lang=&#34;&#34;&gt;

```
    ...
    <span class="ansi-magenta-fg">2022-02-15 14:01:18.924 </span><span class="ansi-green-fg">[1644962478210532/train/2 (pid 46783)] </span><span class="ansi-bold">Task is starting.</span>
    <span class="ansi-magenta-fg">2022-02-15 14:01:19.566 </span><span class="ansi-green-fg">[1644962478210532/train/2 (pid 46783)] </span>the train step
    <span class="ansi-magenta-fg">2022-02-15 14:01:19.632 </span><span class="ansi-green-fg">[1644962478210532/train/2 (pid 46783)] </span><span class="ansi-bold">Task finished successfully.</span>
    ...
```

&lt;/CodeOutputBlock&gt;

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Black" class="doc_header"><code>class</code> <code>Black</code><a href="https://github.com/outerbounds/nbdoc/tree/master/nbdoc/mdx.py#L220" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>Black</code>(<strong>*<code>args</code></strong>, <strong>**<code>kwargs</code></strong>) :: <code>Preprocessor</code></p>
</blockquote>
<p>Format code that has a cell tag <code>black</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="/nbdoc/mdx.html#Black"><code>Black</code></a> is a preprocessor that will format cells that have the cell tag <code>black</code> with <a href="https://github.com/psf/black">Python black</a> code formatting.  You can apply tags via the notebook interface or with a comment <code>meta:tag=black</code>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This is how cell formatting looks before <a href="https://github.com/psf/black">black</a> formatting:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">show_plain_md</span><span class="p">(</span><span class="s1">&#39;test_files/black.ipynb&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Format with black


```python
#meta:tag=black
j = [1,
     2,
     3
]
```


```python
%%writefile black_test.py
#meta:tag=black


def very_important_function(template: str, *variables, file: os.PathLike, engine: str, header: bool = True, debug: bool = False):
    &#34;&#34;&#34;Applies `variables` to the `template` and writes to `file`.&#34;&#34;&#34;
    with open(file, &#39;w&#39;) as f:
        pass
```

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>After black is applied, the code looks like this:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">c</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">run_preprocessor</span><span class="p">([</span><span class="n">InjectMeta</span><span class="p">,</span> <span class="n">UpdateTags</span><span class="p">,</span> <span class="n">CleanMagics</span><span class="p">,</span> <span class="n">Black</span><span class="p">],</span> <span class="s1">&#39;test_files/black.ipynb&#39;</span><span class="p">,</span> <span class="n">display_results</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">assert</span> <span class="s1">&#39;[1, 2, 3]&#39;</span> <span class="ow">in</span> <span class="n">c</span>
<span class="k">assert</span> <span class="s1">&#39;very_important_function(</span><span class="se">\n</span><span class="s1">    template: str,&#39;</span> <span class="ow">in</span> <span class="n">c</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Format with black


```python
j = [1, 2, 3]
```


```python
def very_important_function(
    template: str,
    *variables,
    file: os.PathLike,
    engine: str,
    header: bool = True,
    debug: bool = False
):
    &#34;&#34;&#34;Applies `variables` to the `template` and writes to `file`.&#34;&#34;&#34;
    with open(file, &#34;w&#34;) as f:
        pass
```

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="CatFiles" class="doc_header"><code>class</code> <code>CatFiles</code><a href="https://github.com/outerbounds/nbdoc/tree/master/nbdoc/mdx.py#L229" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>CatFiles</code>(<strong>*<code>args</code></strong>, <strong>**<code>kwargs</code></strong>) :: <code>Preprocessor</code></p>
</blockquote>
<p>Cat arbitrary files with %cat</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="BashIdentify" class="doc_header"><code>class</code> <code>BashIdentify</code><a href="https://github.com/outerbounds/nbdoc/tree/master/nbdoc/mdx.py#L240" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>BashIdentify</code>(<strong>*<code>args</code></strong>, <strong>**<code>kwargs</code></strong>) :: <code>Preprocessor</code></p>
</blockquote>
<p>A preprocessor to identify bash commands and mark them appropriately</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>When we issue a shell command in a notebook with <code>!</code>, we need to change the code-fence from <code>python</code> to <code>bash</code> and remove the <code>!</code>:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">c</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">run_preprocessor</span><span class="p">([</span><span class="n">MetaflowTruncate</span><span class="p">,</span> <span class="n">CleanMagics</span><span class="p">,</span> <span class="n">BashIdentify</span><span class="p">],</span> <span class="s1">&#39;test_files/run_flow.ipynb&#39;</span><span class="p">,</span> <span class="n">display_results</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">assert</span> <span class="s2">&quot;```bash&quot;</span> <span class="ow">in</span> <span class="n">c</span> <span class="ow">and</span> <span class="s1">&#39;!python&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">c</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>```bash
python myflow.py run
```

&lt;CodeOutputBlock lang=&#34;bash&#34;&gt;

```
    <span class="ansi-magenta-fg"> </span><span class="ansi-bold">Workflow starting (run-id 1647304124981100):</span>
    <span class="ansi-magenta-fg"> </span><span class="ansi-green-fg">[1647304124981100/start/1 (pid 41951)] </span><span class="ansi-bold">Task is starting.</span>
    <span class="ansi-magenta-fg"> </span><span class="ansi-green-fg">[1647304124981100/start/1 (pid 41951)] </span>this is the start
    <span class="ansi-magenta-fg"> </span><span class="ansi-green-fg">[1647304124981100/start/1 (pid 41951)] </span><span class="ansi-bold">Task finished successfully.</span>
    <span class="ansi-magenta-fg"> </span><span class="ansi-green-fg">[1647304124981100/end/2 (pid 41954)] </span><span class="ansi-bold">Task is starting.</span>
    <span class="ansi-magenta-fg"> </span><span class="ansi-green-fg">[1647304124981100/end/2 (pid 41954)] </span>this is the end
    <span class="ansi-magenta-fg"> </span><span class="ansi-green-fg">[1647304124981100/end/2 (pid 41954)] </span><span class="ansi-bold">Task finished successfully.</span>
    <span class="ansi-magenta-fg"> </span><span class="ansi-bold">Done!</span>
    
```

&lt;/CodeOutputBlock&gt;

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="CleanShowDoc" class="doc_header"><code>class</code> <code>CleanShowDoc</code><a href="https://github.com/outerbounds/nbdoc/tree/master/nbdoc/mdx.py#L261" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>CleanShowDoc</code>(<strong>*<code>args</code></strong>, <strong>**<code>kwargs</code></strong>) :: <code>Preprocessor</code></p>
</blockquote>
<p>Ensure that ShowDoc output gets cleaned in the associated notebook.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">_result</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">run_preprocessor</span><span class="p">([</span><span class="n">CleanShowDoc</span><span class="p">],</span> <span class="s1">&#39;test_files/doc.ipynb&#39;</span><span class="p">)</span>
<span class="k">assert</span> <span class="s1">&#39;&lt;HTMLRemove&gt;&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_result</span>
<span class="nb">print</span><span class="p">(</span><span class="n">_result</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>```python
from fastcore.all import test_eq
from nbdoc.showdoc import ShowDoc
```


&lt;DocSection type=&#34;function&#34; name=&#34;test_eq&#34; module=&#34;fastcore.test&#34; link=&#34;https://github.com/fastcore/tree/masterhttps://github.com/fastai/fastcore/tree/master/fastcore/test.py#L34&#34;&gt;
&lt;SigArgSection&gt;
&lt;SigArg name=&#34;a&#34; /&gt;&lt;SigArg name=&#34;b&#34; /&gt;
&lt;/SigArgSection&gt;
&lt;Description summary=&#34;`test` that `a==b`&#34; /&gt;

&lt;/DocSection&gt;


</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Composing-Preprocessors-Into-A-Pipeline">Composing Preprocessors Into A Pipeline<a class="anchor-link" href="#Composing-Preprocessors-Into-A-Pipeline"> </a></h2><p>Lets see how you can compose all of these preprocessors together to process notebooks appropriately:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_mdx_exporter" class="doc_header"><code>get_mdx_exporter</code><a href="https://github.com/outerbounds/nbdoc/tree/master/nbdoc/mdx.py#L278" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_mdx_exporter</code>(<strong><code>template_file</code></strong>=<em><code>'ob.tpl'</code></em>)</p>
</blockquote>
<p>A mdx notebook exporter which composes many pre-processors together.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="/nbdoc/mdx.html#get_mdx_exporter"><code>get_mdx_exporter</code></a> combines all of the previous preprocessors, along with the built in <code>TagRemovePreprocessor</code> to allow for hiding cell inputs/outputs based on cell tags.  Here is an example of markdown generated from a notebook with the default preprocessing:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">show_plain_md</span><span class="p">(</span><span class="s1">&#39;test_files/example_input.ipynb&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>---
title: my hello page title
description: my hello page description
hide_table_of_contents: true
---
## This is a test notebook

This is a shell command:


```python
! echo hello
```

    hello


We are writing a python script to disk:


```python
%%writefile myflow.py

from metaflow import FlowSpec, step

class MyFlow(FlowSpec):
    
    @step
    def start(self):
        print(&#39;this is the start&#39;)
        self.next(self.end)
    
    @step
    def end(self):
        print(&#39;this is the end&#39;)

if __name__ == &#39;__main__&#39;:
    MyFlow()
```

    Overwriting myflow.py


Another shell command where we run a flow:


```python
#cell_meta:show_steps=start
! python myflow.py run
```

    <span class="ansi-magenta-intense-fg ansi-bold">Metaflow 2.5.3</span><span class="ansi-magenta-fg"> executing </span><span class="ansi-red-intense-fg ansi-bold">MyFlow</span><span class="ansi-magenta-fg"> for </span><span class="ansi-red-intense-fg ansi-bold">user:hamel</span>
    <span class="ansi-magenta-fg">Validating your flow...</span>
    <span class="ansi-green-intense-fg ansi-bold">    The graph looks good!</span>
    <span class="ansi-magenta-fg">Running pylint...</span>
    <span class="ansi-green-intense-fg ansi-bold">    Pylint is happy!</span>
    <span class="ansi-magenta-fg">2022-03-10 22:52:37.069 </span><span class="ansi-bold">Workflow starting (run-id 1646981557065941):</span>
    <span class="ansi-magenta-fg">2022-03-10 22:52:37.077 </span><span class="ansi-green-fg">[1646981557065941/start/1 (pid 54733)] </span><span class="ansi-bold">Task is starting.</span>
    <span class="ansi-magenta-fg">2022-03-10 22:52:37.752 </span><span class="ansi-green-fg">[1646981557065941/start/1 (pid 54733)] </span>this is the start
    <span class="ansi-magenta-fg">2022-03-10 22:52:37.841 </span><span class="ansi-green-fg">[1646981557065941/start/1 (pid 54733)] </span><span class="ansi-bold">Task finished successfully.</span>
    <span class="ansi-magenta-fg">2022-03-10 22:52:37.849 </span><span class="ansi-green-fg">[1646981557065941/end/2 (pid 54736)] </span><span class="ansi-bold">Task is starting.</span>
    <span class="ansi-magenta-fg">2022-03-10 22:52:38.519 </span><span class="ansi-green-fg">[1646981557065941/end/2 (pid 54736)] </span>this is the end
    <span class="ansi-magenta-fg">2022-03-10 22:52:38.604 </span><span class="ansi-green-fg">[1646981557065941/end/2 (pid 54736)] </span><span class="ansi-bold">Task finished successfully.</span>
    <span class="ansi-magenta-fg">2022-03-10 22:52:38.604 </span><span class="ansi-bold">Done!</span>
    

This is a normal python cell:


```python
a = 2
a
```




    2



The next cell has a cell tag of `remove_input`, so you should only see the output of the cell:


```python
#meta:tag=remove_input
print(&#39;hello, you should not see the print statement that produced me&#39;)
```

    hello, you should not see the print statement that produced me


Pandas DataFrame:


```python
import pandas as pd
pd.read_csv(&#39;https://github.com/outerbounds/.data/raw/main/hospital_readmission.csv&#39;).head(3).iloc[:, :3]
```




&lt;div&gt;
&lt;style scoped&gt;
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
&lt;/style&gt;
&lt;table border=&#34;1&#34; class=&#34;dataframe&#34;&gt;
  &lt;thead&gt;
    &lt;tr style=&#34;text-align: right;&#34;&gt;
      &lt;th&gt;&lt;/th&gt;
      &lt;th&gt;time_in_hospital&lt;/th&gt;
      &lt;th&gt;num_lab_procedures&lt;/th&gt;
      &lt;th&gt;num_procedures&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;th&gt;0&lt;/th&gt;
      &lt;td&gt;14&lt;/td&gt;
      &lt;td&gt;41&lt;/td&gt;
      &lt;td&gt;0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;th&gt;1&lt;/th&gt;
      &lt;td&gt;2&lt;/td&gt;
      &lt;td&gt;30&lt;/td&gt;
      &lt;td&gt;0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;th&gt;2&lt;/th&gt;
      &lt;td&gt;5&lt;/td&gt;
      &lt;td&gt;66&lt;/td&gt;
      &lt;td&gt;0&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;



A matplotlib plot:


```python
from matplotlib import pyplot as plt
plt.plot(range(20), range(20))
plt.plot(range(10), range(10))
plt.show()
```


    
![png](output_15_0.png)
    


</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Here is the same notebook, but with all of the preprocessors that we defined in this module.  Additionally, we hide the input of the last cell which prints <code>hello, you should not see the print statement...</code> by using the built in <code>TagRemovePreprocessor</code>:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">exp</span> <span class="o">=</span> <span class="n">get_mdx_exporter</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">exp</span><span class="o">.</span><span class="n">from_filename</span><span class="p">(</span><span class="s1">&#39;test_files/example_input.ipynb&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>---
title: my hello page title
description: my hello page description
hide_table_of_contents: true
---


&lt;!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! Instead, edit the notebook w/the location &amp; name as this file. --&gt;

## This is a test notebook

This is a shell command:


```bash
echo hello
```

&lt;CodeOutputBlock lang=&#34;bash&#34;&gt;

```
    hello
```

&lt;/CodeOutputBlock&gt;

We are writing a python script to disk:


```py title=&#34;myflow.py&#34;
from metaflow import FlowSpec, step

class MyFlow(FlowSpec):
    
    @step
    def start(self):
        print(&#39;this is the start&#39;)
        self.next(self.end)
    
    @step
    def end(self):
        print(&#39;this is the end&#39;)

if __name__ == &#39;__main__&#39;:
    MyFlow()
```

Another shell command where we run a flow:


```bash
python myflow.py run
```

&lt;CodeOutputBlock lang=&#34;bash&#34;&gt;

```
    ...
     [1646981557065941/start/1 (pid 54733)] Task is starting.
     [1646981557065941/start/1 (pid 54733)] this is the start
     [1646981557065941/start/1 (pid 54733)] Task finished successfully.
    ...
```

&lt;/CodeOutputBlock&gt;

This is a normal python cell:


```python
a = 2
a
```

&lt;CodeOutputBlock lang=&#34;python&#34;&gt;

```
    2
```

&lt;/CodeOutputBlock&gt;

The next cell has a cell tag of `remove_input`, so you should only see the output of the cell:

&lt;CodeOutputBlock lang=&#34;python&#34;&gt;

```
    hello, you should not see the print statement that produced me
```

&lt;/CodeOutputBlock&gt;

Pandas DataFrame:


```python
import pandas as pd
pd.read_csv(&#39;https://github.com/outerbounds/.data/raw/main/hospital_readmission.csv&#39;).head(3).iloc[:, :3]
```
    
&lt;HTMLOutputBlock &gt;




```html
&lt;div&gt;
&lt;style scoped&gt;
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
&lt;/style&gt;
&lt;table border=&#34;1&#34; class=&#34;dataframe&#34;&gt;
  &lt;thead&gt;
    &lt;tr style=&#34;text-align: right;&#34;&gt;
      &lt;th&gt;&lt;/th&gt;
      &lt;th&gt;time_in_hospital&lt;/th&gt;
      &lt;th&gt;num_lab_procedures&lt;/th&gt;
      &lt;th&gt;num_procedures&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;th&gt;0&lt;/th&gt;
      &lt;td&gt;14&lt;/td&gt;
      &lt;td&gt;41&lt;/td&gt;
      &lt;td&gt;0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;th&gt;1&lt;/th&gt;
      &lt;td&gt;2&lt;/td&gt;
      &lt;td&gt;30&lt;/td&gt;
      &lt;td&gt;0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;th&gt;2&lt;/th&gt;
      &lt;td&gt;5&lt;/td&gt;
      &lt;td&gt;66&lt;/td&gt;
      &lt;td&gt;0&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
```



&lt;/HTMLOutputBlock&gt;

A matplotlib plot:


```python
from matplotlib import pyplot as plt
plt.plot(range(20), range(20))
plt.plot(range(10), range(10))
plt.show()
```

&lt;CodeOutputBlock lang=&#34;python&#34;&gt;

```
    
![png](_example_input_files/output_15_0.png)
    
```

&lt;/CodeOutputBlock&gt;

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

</div>


